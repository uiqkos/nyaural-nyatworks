{% extends "base.html" %}
{% block content %}
  <h1 class="nya-text" style="margin-top: 5%; margin-bottom: -100px">Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°</h1>

  <div class="container search" id="mainContainer">

  </div>

  <script type="text/javascript">

    let randomToxic = function () {
      if (Math.random() > 0.5)
        {#  return '<span class="nya-negative">toxic</span> ðŸ¤¬'#}
        {#return '<span class="nya-positive">toxic</span> ðŸ˜€'#}
        return '<span class="nya-negative rounded-pill badge">toxic</span>'
      return '<span class="nya-positive rounded-pill badge">no toxic</span>'
    }

    let randomSentiment = function () {
      let r = Math.random()
      if (r > 0.6)
        {#  return '<span class="nya-negative">sentiment</span>ðŸ˜¡'#}
        {#return '<span class="nya-positive">sentiment</span> ðŸ˜€'#}
        return '<span class="nya-negative rounded-pill badge">negative</span>'
      if (r > 0.3)
        return '<span class="nya-neutral rounded-pill badge">neutral</span>'
      return '<span class="nya-positive rounded-pill badge">positive</span>'
    }

    let randomSarcasm = function () {
      if (Math.random() > 0.5)
        {#  return '<span class="nya-negative">sarcasm</span> ðŸ¤£'#}
        {#return '<span class="nya-positive">sarcasm</span> ðŸ˜€'#}
        return '<span class="nya-negative rounded-pill badge">sarcasm</span>'
      return '<span class="nya-positive rounded-pill badge">no sarcasm</span>'
    }

    function commentToHTML(comment) {
      return '' +
        '<p class="nya-text">' + comment.author + '</p>' +
        '<div class="comment">' +
        '<p style="margin-left: 1%">' + comment.text + '</p>' +
        ((comment.score !== undefined) ? ('<p>' + comment.score + '</p>') : '') +
        randomToxic() + ' | ' + randomSentiment() + ' | ' + randomSarcasm() +
        '</div>'
    }

    function expand(comment, is_nested) {
      let html_text = ''

      if (comment.comments.length === 0) {
        return commentToHTML(comment)
      }

      if (is_nested) {
        html_text += '<div class="list-group nested ">'
      } else {
        html_text += '<div class="list-group">'
      }

      html_text += commentToHTML(comment)

      comment.comments.forEach(function (nested) {
        html_text += '<div class="list-group-item comment" style="border-radius: 0">'
        html_text += expand(nested, true)
        html_text += '</div>'
      })

      html_text += '</div>'
      return html_text
    }

    mainContainer = document.getElementById('mainContainer')
    let expanded = expand({{ comments | safe }}, false)
    mainContainer.innerHTML += '<div class="list-group">'
    mainContainer.innerHTML += expanded
    mainContainer.innerHTML += '</div>'
  </script>

{% endblock %}
