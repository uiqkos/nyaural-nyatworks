{% extends "base.html" %}
{% block content %}
  <h1 class="nya-text" style="margin-top: 5%; margin-bottom: -100px">Результаты анализа</h1>

  <div class="container search" id="mainContainer">

  </div>

  <script type="text/javascript">

    let floatColor = function(r) {
        let red = 255 - (255 * (r < 0.5) * (1 - r))
        let green = 255 - (255 * (r > 0.5) * (r - 0.5) * 2)
        let color = (r > 0.6) ? 'white' : 'black'
        return `background-color: rgb(${red}, ${green}, 0); color: ${color}`
    }

    let borderFloatColor = function(r) {
        return "rgba(255, 133, 0, " + (1 - (r / 4)).toString() + ")"
    }

    let pill = function(target, value) {
        return '<span class="rounded-pill badge" style="' + floatColor(value) + '">' + target + ' ' + value.toFixed(3) + '%</span>'
    }

    function commentToHTML(comment) {
      return '' +
        '<p class="nya-text">' + comment.author + '</p>' +
        {#'<div class="comment">' +#}
        '<p style="margin-left: 1%">' + comment.text + '</p>' +
        {% comment %}pill('toxic', comment.toxic) + ' | ' + pill('sentiment', {% endcomment %}comment.sentiment{% comment %}) + ' | ' + pill('sarcasm', comment.sarcasm){% endcomment %}
        {#'</div>'#}
    }

    function expand(comment, nested_level) {
      let html_text = ''

      if (comment.comments.length === 0) {
        return commentToHTML(comment)
      }

      if (nested_level) {
        html_text += '<div class="list-group nested" style="border-radius: 0; border-left: 2px solid ' + borderFloatColor(nested_level + 1) + '">'
      } else {
        html_text += '<div class="list-group" style="border-radius: 0; border-left: 2px solid ' + borderFloatColor(nested_level + 1) + '">'
      }

      html_text += commentToHTML(comment)

      comment.comments.forEach(function (nested) {
        html_text += '<div class="comment list-group-item">'
        html_text += expand(nested, nested_level + 1)
        html_text += '</div>'
      })

      html_text += '</div>'
      return html_text
    }

    mainContainer = document.getElementById('mainContainer')
    let expanded = expand({{ comments | safe }}, 0)
    mainContainer.innerHTML += '<div class="list-group">'
    mainContainer.innerHTML += expanded
    mainContainer.innerHTML += '</div>'
  </script>

{% endblock %}
